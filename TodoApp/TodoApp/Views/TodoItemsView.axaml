<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:TodoApp.ViewModels"
			 xmlns:converters="using:TodoApp.Converters"
             xmlns:icons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="TodoApp.Views.TodoItemsView"
             x:DataType="vm:TodoItemsViewModel"
             x:CompileBindings="True">

	<Design.DataContext>
		<!-- This only sets the DataContext for the previewer in an IDE,
         to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
		<vm:TodoItemsViewModel />
	</Design.DataContext>

	<UserControl.Resources>
		<converters:BoolToColorConverter x:Key="BoolToColorConverter" />
	</UserControl.Resources>

	<ScrollViewer>
		<Grid RowDefinitions="1*, 5*">

			<Button Margin="10" Width="40" Height="40" Command="{Binding OpenPopupCommand}">
				<DockPanel LastChildFill="True">
					<icons:MaterialIcon Width="40" Height="40" Kind="Add" DockPanel.Dock="Top"/>
				</DockPanel>
			</Button>

			<Button Margin="10" Width="40" Height="40" Command="{Binding GetNotDueItemsCommand}" HorizontalAlignment="Right">
				<DockPanel LastChildFill="True">
					<icons:MaterialIcon Width="40" Height="40" Kind="Filter" DockPanel.Dock="Top"/>
				</DockPanel>
			</Button>

			<Button Margin="10 10 60 10" Width="40" Height="40" Command="{Binding GetAllItemsCommand}" HorizontalAlignment="Right">
				<DockPanel LastChildFill="True">
					<icons:MaterialIcon Width="40" Height="40" Kind="Reload" DockPanel.Dock="Top"/>
				</DockPanel>
			</Button>

			<TextBlock HorizontalAlignment="Center" FontSize="25" FontWeight="Bold" Grid.Row="0" Margin="10">Todo List</TextBlock>

			<ItemsRepeater Items="{Binding TodoItems}" Margin="0, 10, 0, 0" Grid.Row="1" HorizontalAlignment="Center" Name="Repeater">
				<ItemsRepeater.Layout>
					<UniformGridLayout ></UniformGridLayout>
				</ItemsRepeater.Layout>
				<ItemsRepeater.ItemTemplate>
					<DataTemplate>
						<Panel Margin="10" Width="200" Background="{Binding IsDone, Converter={StaticResource BoolToColorConverter}}">
							<Grid RowDefinitions="Auto, Auto, 1*" Margin="5,5,5,5">

								<Button
									Grid.Row="0"
									Width="30"
									Height="30"
									HorizontalAlignment="Right"
									Command="{ReflectionBinding #Repeater.DataContext.DeleteCommand}"
									CommandParameter="{Binding .}">
									<DockPanel LastChildFill="True">
										<icons:MaterialIcon Width="30" Height="30" Kind="Remove" DockPanel.Dock="Top"/>
									</DockPanel>
								</Button>
								<Button 
									Grid.Row="2"
									Width="30"
									Height="30"
									HorizontalAlignment="Right"
									Command="{ReflectionBinding #Repeater.DataContext.CalculateMassCommand}"
									CommandParameter="{Binding .}">
									<DockPanel LastChildFill="True">
										<icons:MaterialIcon Width="30" Height="30" Kind="RobotConfused" DockPanel.Dock="Bottom"/>
									</DockPanel>
								</Button>

								<Button
									Grid.Row="1"
									Width="30"
									Height="30"
									HorizontalAlignment="Right"
									Command="{ReflectionBinding #Repeater.DataContext.SetDoneCommand}"
									CommandParameter="{Binding .}">
									<DockPanel LastChildFill="True">
										<icons:MaterialIcon Width="30" Height="30" Kind="Done" DockPanel.Dock="Bottom"/>
									</DockPanel>
								</Button>

								<TextBlock Text="{Binding Title}" Grid.Row="0" Margin="0,0,0,5" FontWeight="Bold" VerticalAlignment="Top" HorizontalAlignment="Center" TextWrapping="Wrap"></TextBlock>
								<TextBlock Text="{Binding Description}" Grid.Row="1" FontStyle="Italic" VerticalAlignment="Center" HorizontalAlignment="Center" TextWrapping="Wrap"></TextBlock>
								<TextBlock Text="{Binding DueDate, StringFormat={}{0:yyyy/MM/dd}}" Grid.Row="2" VerticalAlignment="Bottom" HorizontalAlignment="Center"></TextBlock>
							</Grid>
						</Panel>
					</DataTemplate>
				</ItemsRepeater.ItemTemplate>
			</ItemsRepeater>

		</Grid>
	</ScrollViewer>
</UserControl>
